Dirty hack to fix installation of locales-all: instead of just locking the
archive extension (which is not supported on hurd-i386), lock it all.

---
 locarchive.c |    9 +++++++++
 1 file changed, 9 insertions(+)

diff --git a/locale/programs/locarchive.c b/locale/programs/locarchive.c
index 85ba77d..8a2352f 100644
--- a/locale/programs/locarchive.c
+++ b/locale/programs/locarchive.c
@@ -415,7 +415,16 @@ enlarge_archive (struct locarhandle *ah, const struct locarhead *head)
     }
 
   /* Lock the new file.  */
+#ifdef __GNU__
+  struct flock fl;
+  fl.l_whence = SEEK_SET;
+  fl.l_start = 0;
+  fl.l_len = 0;
+  fl.l_type = F_WRLCK;
+  if (fcntl(fd, F_SETLKW, &fl) != 0)
+#else
   if (lockf64 (fd, F_LOCK, total) != 0)
+#endif
     {
       int errval = errno;
       unlink (fname);
